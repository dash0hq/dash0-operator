---
apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  annotations:
    controller-gen.kubebuilder.io/version: v0.14.0
    {{- if .Values.operator.certManager.useCertManager }}
    {{- with .Values.operator.certManager.certManagerAnnotations }}
      {{- toYaml . | nindent 4 }}
    {{- end }}
    {{- end }}
  name: dash0syntheticchecks.operator.dash0.com
spec:
  group: operator.dash0.com
  names:
    kind: Dash0SyntheticCheck
    listKind: Dash0SyntheticCheckList
    plural: dash0syntheticchecks
    singular: dash0syntheticcheck
  scope: Namespaced
  versions:
  - name: v1alpha1
    schema:
      openAPIV3Schema:
        description: Dash0SyntheticCheck is the Schema for the dash0syntheticchecks
          API
        properties:
          apiVersion:
            description: |-
              APIVersion defines the versioned schema of this representation of an object.
              Servers should convert recognized schemas to the latest internal value, and
              may reject unrecognized values.
              More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#resources
            type: string
          kind:
            description: |-
              Kind is a string value representing the REST resource this object represents.
              Servers may infer this from the endpoint the client submits requests to.
              Cannot be updated.
              In CamelCase.
              More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds
            type: string
          metadata:
            type: object
          spec:
            description: Dash0SyntheticCheckSpec defines the desired state of Dash0SyntheticCheck
            properties:
              display:
                description: Dash0SyntheticCheckDisplay defines the display configuration
                properties:
                  name:
                    description: |-
                      Short-form name for the synthetic check.
                    type: string
                required:
                - name
                type: object
              enabled:
                type: boolean
              notifications:
                description: Dash0SyntheticCheckNotifications defines notification
                  configuration
                properties:
                  channels:
                    description: |-
                      The channel IDs that notifications should be sent to in case the check is critical or degraded after
                      executing all the retries.
                    items:
                      description: NotificationChannelID is the unique identifier
                        for a notification channel.
                      format: uuid
                      type: string
                    type: array
                required:
                - channels
                type: object
              plugin:
                description: Dash0SyntheticCheckPlugin defines the plugin configuration
                properties:
                  kind:
                    enum:
                    - http
                    type: string
                  spec:
                    description: Dash0SyntheticCheckHTTPPluginSpec defines the HTTP
                      plugin specification
                    properties:
                      assertions:
                        description: Dash0SyntheticCheckHTTPAssertions defines HTTP
                          assertions
                        properties:
                          criticalAssertions:
                            items:
                              description: Dash0SyntheticCheckAssertion defines a
                                check assertion
                              properties:
                                kind:
                                  enum:
                                  - status_code
                                  - response_header
                                  - json_body
                                  - text_body
                                  - timing
                                  - error
                                  - ssl_certificate
                                  type: string
                                spec:
                                  description: Dash0SyntheticCheckAssertionSpec defines
                                    assertion specification
                                  properties:
                                    jsonPath:
                                      description: For json_body assertions
                                      type: string
                                    key:
                                      description: For response_header assertions
                                      type: string
                                    operator:
                                      description: For status_code, timing assertions
                                      enum:
                                      - is
                                      - is_not
                                      - gt
                                      - lt
                                      - gte
                                      - lte
                                      type: string
                                    type:
                                      description: For timing assertions
                                      enum:
                                      - total
                                      - dns
                                      - connection
                                      - ssl
                                      - request
                                      - response
                                      type: string
                                    value:
                                      description: For all assertions
                                      type: string
                                  type: object
                              required:
                              - kind
                              - spec
                              type: object
                              x-kubernetes-validations:
                              - rule: (self.kind == 'status_code' && has(self.spec.operator)
                                  && has(self.spec.value)) || (self.kind == 'response_header'
                                  && has(self.spec.key) && has(self.spec.operator)
                                  && has(self.spec.value)) || (self.kind == 'json_body'
                                  && has(self.spec.jsonPath) && has(self.spec.operator)
                                  && has(self.spec.value)) || (self.kind == 'text_body'
                                  && has(self.spec.operator) && has(self.spec.value))
                                  || (self.kind == 'timing' && has(self.spec.type)
                                  && has(self.spec.operator) && has(self.spec.value))
                                  || (self.kind == 'error' && has(self.spec.value))
                                  || (self.kind == 'ssl_certificate' && has(self.spec.value))
                            type: array
                          degradedAssertions:
                            items:
                              description: Dash0SyntheticCheckAssertion defines a
                                check assertion
                              properties:
                                kind:
                                  enum:
                                  - status_code
                                  - response_header
                                  - json_body
                                  - text_body
                                  - timing
                                  - error
                                  - ssl_certificate
                                  type: string
                                spec:
                                  description: Dash0SyntheticCheckAssertionSpec defines
                                    assertion specification
                                  properties:
                                    jsonPath:
                                      description: For json_body assertions
                                      type: string
                                    key:
                                      description: For response_header assertions
                                      type: string
                                    operator:
                                      description: For status_code, timing assertions
                                      enum:
                                      - is
                                      - is_not
                                      - gt
                                      - lt
                                      - gte
                                      - lte
                                      type: string
                                    type:
                                      description: For timing assertions
                                      enum:
                                      - total
                                      - dns
                                      - connection
                                      - ssl
                                      - request
                                      - response
                                      type: string
                                    value:
                                      description: For all assertions
                                      type: string
                                  type: object
                              required:
                              - kind
                              - spec
                              type: object
                              x-kubernetes-validations:
                              - rule: (self.kind == 'status_code' && has(self.spec.operator)
                                  && has(self.spec.value)) || (self.kind == 'response_header'
                                  && has(self.spec.key) && has(self.spec.operator)
                                  && has(self.spec.value)) || (self.kind == 'json_body'
                                  && has(self.spec.jsonPath) && has(self.spec.operator)
                                  && has(self.spec.value)) || (self.kind == 'text_body'
                                  && has(self.spec.operator) && has(self.spec.value))
                                  || (self.kind == 'timing' && has(self.spec.type)
                                  && has(self.spec.operator) && has(self.spec.value))
                                  || (self.kind == 'error' && has(self.spec.value))
                                  || (self.kind == 'ssl_certificate' && has(self.spec.value))
                            type: array
                        required:
                        - criticalAssertions
                        - degradedAssertions
                        type: object
                      request:
                        description: Dash0SyntheticCheckHTTPRequest defines the HTTP
                          request configuration
                        properties:
                          basicAuthentication:
                            description: Dash0SyntheticCheckHTTPBasicAuthentication
                              defines basic authentication
                            properties:
                              password:
                                type: string
                              username:
                                type: string
                            required:
                            - password
                            - username
                            type: object
                          body:
                            description: Dash0SyntheticCheckHTTPBody defines HTTP
                              request body
                            properties:
                              kind:
                                enum:
                                - json
                                - graphql
                                - form
                                - raw
                                type: string
                              spec:
                                description: Dash0SyntheticCheckHTTPBodySpec defines
                                  the body specification
                                properties:
                                  content:
                                    maxLength: 2048
                                    type: string
                                required:
                                - content
                                type: object
                            required:
                            - kind
                            - spec
                            type: object
                          headers:
                            items:
                              description: Dash0SyntheticCheckHTTPHeader defines an
                                HTTP header
                              properties:
                                name:
                                  type: string
                                value:
                                  type: string
                              required:
                              - name
                              - value
                              type: object
                            type: array
                          method:
                            enum:
                            - get
                            - post
                            - put
                            - delete
                            - head
                            - patch
                            type: string
                          queryParameters:
                            items:
                              description: Dash0SyntheticCheckHTTPQueryParameter defines
                                a query parameter
                              properties:
                                name:
                                  type: string
                                value:
                                  type: string
                              required:
                              - name
                              - value
                              type: object
                            type: array
                          redirects:
                            enum:
                            - follow
                            - disabled
                            type: string
                          tls:
                            description: Dash0SyntheticCheckHTTPTLS defines TLS configuration
                            properties:
                              allowInsecure:
                                type: boolean
                            required:
                            - allowInsecure
                            type: object
                          tracing:
                            description: Dash0SyntheticCheckHTTPTracing defines tracing
                              configuration
                            properties:
                              addTracingHeaders:
                                type: boolean
                            required:
                            - addTracingHeaders
                            type: object
                          url:
                            type: string
                        required:
                        - headers
                        - method
                        - queryParameters
                        - redirects
                        - tls
                        - tracing
                        - url
                        type: object
                    required:
                    - assertions
                    - request
                    type: object
                required:
                - kind
                - spec
                type: object
                x-kubernetes-validations:
                - rule: self.kind == 'http'
              retries:
                description: Dash0SyntheticCheckRetries defines the retry configuration
                properties:
                  kind:
                    enum:
                    - "off"
                    - fixed
                    - linear
                    - exponential
                    type: string
                  spec:
                    description: Dash0SyntheticCheckRetriesSpec defines retry specification
                    properties:
                      attempts:
                        description: For fixed, linear, exponential retries
                        maximum: 10
                        minimum: 0
                        type: integer
                      delay:
                        description: For fixed, linear, exponential retries
                        pattern: (\d+(ms|s|m|h|d|w|M|Q|y))+
                        type: string
                      maximumDelay:
                        description: For linear, exponential retries
                        pattern: (\d+(ms|s|m|h|d|w|M|Q|y))+
                        type: string
                    type: object
                required:
                - kind
                - spec
                type: object
                x-kubernetes-validations:
                - rule: (self.kind == 'off') || (self.kind == 'fixed' && has(self.spec.attempts)
                    && has(self.spec.delay)) || (self.kind == 'linear' && has(self.spec.attempts)
                    && has(self.spec.delay) && has(self.spec.maximumDelay)) || (self.kind
                    == 'exponential' && has(self.spec.attempts) && has(self.spec.delay)
                    && has(self.spec.maximumDelay))
              schedule:
                description: Dash0SyntheticCheckSchedule defines the schedule configuration
                properties:
                  interval:
                    description: Specifies a check evaluation frequency.
                    pattern: (\d+(ms|s|m|h|d|w|M|Q|y))+
                    type: string
                  locations:
                    items:
                      type: string
                    maxItems: 128
                    minItems: 1
                    type: array
                  strategy:
                    description: Whether to run checks against all specified locations
                      for every run, or just a single location per run.
                    enum:
                    - all_locations
                    - random_location
                    type: string
                required:
                - interval
                - locations
                - strategy
                type: object
            required:
            - display
            - enabled
            - notifications
            - plugin
            - retries
            - schedule
            type: object
          status:
            description: Dash0SyntheticCheckStatus defines the observed state of Dash0SyntheticCheck
            properties:
              synchronizationError:
                type: string
              synchronizationStatus:
                description: |-
                  Dash0ApiResourceSynchronizationStatus describes the result of synchronizing a (non-third-party) Kubernetes resource
                  (e.g. synthetic checks) to the Dash0 API.
                enum:
                - successful
                - failed
                type: string
              synchronizedAt:
                format: date-time
                type: string
              validationIssues:
                items:
                  type: string
                type: array
            required:
            - synchronizationStatus
            - synchronizedAt
            type: object
        type: object
    served: true
    storage: true
    subresources:
      status: {}
